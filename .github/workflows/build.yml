name: Build Android APK

on:
Â  push:
Â Â Â  branches:
Â Â Â Â Â  - main
Â  pull_request:
Â Â Â  branches:
Â Â Â Â Â  - main

jobs:
Â  build:
Â Â Â  runs-on: ubuntu-latest

Â Â Â  steps:
Â Â Â Â Â  - name: ğŸ› ï¸ ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
Â Â Â Â Â Â Â  uses: actions/checkout@v4

Â Â Â Â Â  - name: ğŸ—ï¸ Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
Â Â Â Â Â Â Â  run: |
Â Â Â Â Â Â Â Â Â  sudo apt update
Â Â Â Â Â Â Â Â Â  sudo apt install -y python3 python3-pip openjdk-17-jdk
Â Â Â Â Â Â Â Â Â  pip3 install --upgrade pip

Â Â Â Â Â  - name: ğŸ“¦ Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Buildozer Ğ² Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğ¸
Â Â Â Â Â Â Â  run: |
Â Â Â Â Â Â Â Â Â  python3 -m venv venv
Â Â Â Â Â Â Â Â Â  source venv/bin/activate
Â Â Â Â Â Â Â Â Â  pip install buildozer Cython

Â Â Â Â Â  - name: ğŸ”§ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ swap-Ñ„Ğ°Ğ¹Ğ» (Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ñ…Ğ²Ğ°Ñ‚Ğ¸Ğ»Ğ¾ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸)
Â Â Â Â Â Â Â  run: |
Â Â Â Â Â Â Â Â Â  sudo fallocate -l 4G /swapfile
Â Â Â Â Â Â Â Â Â  sudo chmod 600 /swapfile
Â Â Â Â Â Â Â Â Â  sudo mkswap /swapfile
Â Â Â Â Â Â Â Â Â  sudo swapon /swapfile
Â Â Â Â Â Â Â Â Â  echo "SWAPFILE=/swapfile" >> $GITHUB_ENV

Â Â Â Â Â  - name: ğŸ“¦ Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Android SDK Ğ¸ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµĞ¼ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸
Â Â Â Â Â Â Â  run: |
Â Â Â Â Â Â Â Â Â  mkdir -p ~/.android
Â Â Â Â Â Â Â Â Â  touch ~/.android/repositories.cfg
Â Â Â Â Â Â Â Â Â  wget https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip -O android-sdk.zip
Â Â Â Â Â Â Â Â Â  unzip android-sdk.zip -d $ANDROID_SDK_ROOT
Â Â Â Â Â Â Â Â Â  yes | $ANDROID_SDK_ROOT/cmdline-tools/bin/sdkmanager --update
Â Â Â Â Â Â Â Â Â  yes | $ANDROID_SDK_ROOT/cmdline-tools/bin/sdkmanager --licenses
Â Â Â Â Â Â Â Â Â  $ANDROID_SDK_ROOT/cmdline-tools/bin/sdkmanager "build-tools;34.0.0"

Â Â Â Â Â  - name: ğŸ“¦ Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ APK
Â Â Â Â Â Â Â  run: |
Â Â Â Â Â Â Â Â Â  source venv/bin/activate
Â Â Â Â Â Â Â Â Â  buildozer -v android debug

Â Â Â Â Â  - name: ğŸ“¤ Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ APK Ğ² Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ñ‹
Â Â Â Â Â Â Â  uses: actions/upload-artifact@v4
Â Â Â Â Â Â Â  with:
Â Â Â Â Â Â Â Â Â  name: AutoRegBot-APK
Â Â Â Â Â Â Â Â Â  path: bin/*.apkâ€‹
